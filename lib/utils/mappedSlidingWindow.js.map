{"version":3,"sources":["../../../src/lib/utils/mappedSlidingWindow.js"],"names":["undefinedValue","undefined","windowSize","accumulator","source","skipInitial","mappedSlidingWindow","data","size","apply","arguments","windowData","accumulatorIdx","undef","result","forEach","d","i","mapped","push","shift","pop","x","length"],"mappings":"AAAA;;;;;;kBAMe,YAAW;;AAEzB,KAAIA,iBAAiBC,SAArB;AAAA,KACCC,aAAa,EADd;AAAA,KAECC,4BAFD;AAAA,KAGCC,2BAHD;AAAA,KAICC,cAAc,CAJf;;AAMA;AACA,KAAIC,sBAAsB,SAAtBA,mBAAsB,CAASC,IAAT,EAAe;AACxC,MAAMC,OAAO,oBAAQN,UAAR,EAAoBO,KAApB,CAA0B,IAA1B,EAAgCC,SAAhC,CAAb;AACA,MAAMC,aAAa,EAAnB;AACA,MAAIC,iBAAiB,CAArB;AACA,MAAMC,QAAQ,oBAAQb,cAAR,CAAd;AACA;AACA,MAAMc,SAAS,EAAf;AACAP,OAAKQ,OAAL,CAAa,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAC3B;AACA,OAAIC,eAAJ;AACA,OAAID,IAAKZ,cAAcG,IAAd,GAAqB,CAA9B,EAAkC;AACjCU,aAASL,MAAMG,CAAN,EAASC,CAAT,CAAT;AACAH,WAAOK,IAAP,CAAYD,MAAZ;AACAP,eAAWQ,IAAX,CAAgBD,MAAhB;AACA;AACA;AACD,OAAID,KAAMZ,cAAcG,IAAxB,EAA+B;AAC9B;AACAG,eAAWS,KAAX;AACA;AACDT,cAAWQ,IAAX,CAAgBf,OAAOY,CAAP,EAAUC,CAAV,CAAhB;AACAC,YAASf,YAAYQ,UAAZ,EAAwBM,CAAxB,EAA2BL,gBAA3B,CAAT;AACAE,UAAOK,IAAP,CAAYD,MAAZ;AACAP,cAAWU,GAAX;AACAV,cAAWQ,IAAX,CAAgBD,MAAhB;AACA;AACA,GAnBD;AAoBA,SAAOJ,MAAP;AACA,EA5BD;;AA8BAR,qBAAoBN,cAApB,GAAqC,UAASsB,CAAT,EAAY;AAChD,MAAI,CAACZ,UAAUa,MAAf,EAAuB;AACtB,UAAOvB,cAAP;AACA;AACDA,mBAAiBsB,CAAjB;AACA,SAAOhB,mBAAP;AACA,EAND;AAOAA,qBAAoBJ,UAApB,GAAiC,UAASoB,CAAT,EAAY;AAC5C,MAAI,CAACZ,UAAUa,MAAf,EAAuB;AACtB,UAAOrB,UAAP;AACA;AACDA,eAAaoB,CAAb;AACA,SAAOhB,mBAAP;AACA,EAND;AAOAA,qBAAoBH,WAApB,GAAkC,UAASmB,CAAT,EAAY;AAC7C,MAAI,CAACZ,UAAUa,MAAf,EAAuB;AACtB,UAAOpB,WAAP;AACA;AACDA,gBAAcmB,CAAd;AACA,SAAOhB,mBAAP;AACA,EAND;AAOAA,qBAAoBD,WAApB,GAAkC,UAASiB,CAAT,EAAY;AAC7C,MAAI,CAACZ,UAAUa,MAAf,EAAuB;AACtB,UAAOlB,WAAP;AACA;AACDA,gBAAciB,CAAd;AACA,SAAOhB,mBAAP;AACA,EAND;AAOAA,qBAAoBF,MAApB,GAA6B,UAASkB,CAAT,EAAY;AACxC,MAAI,CAACZ,UAAUa,MAAf,EAAuB;AACtB,UAAOnB,MAAP;AACA;AACDA,WAASkB,CAAT;AACA,SAAOhB,mBAAP;AACA,EAND;;AAQA,QAAOA,mBAAP;AACA,C;;AAhFD;;;;AACA;;;;AACA","file":"mappedSlidingWindow.js","sourcesContent":["\"use strict\";\n\nimport noop from \"./noop\";\nimport identity from \"./identity\";\nimport { functor } from \"./index\";\n\nexport default function() {\n\n\tlet undefinedValue = undefined,\n\t\twindowSize = 10,\n\t\taccumulator = noop,\n\t\tsource = identity,\n\t\tskipInitial = 0;\n\n\t// eslint-disable-next-line prefer-const\n\tlet mappedSlidingWindow = function(data) {\n\t\tconst size = functor(windowSize).apply(this, arguments);\n\t\tconst windowData = [];\n\t\tlet accumulatorIdx = 0;\n\t\tconst undef = functor(undefinedValue);\n\t\t// console.log(skipInitial, size, data.length, windowData.length);\n\t\tconst result = [];\n\t\tdata.forEach(function(d, i) {\n\t\t\t// console.log(d, i, windowData.length);\n\t\t\tlet mapped;\n\t\t\tif (i < (skipInitial + size - 1)) {\n\t\t\t\tmapped = undef(d, i);\n\t\t\t\tresult.push(mapped);\n\t\t\t\twindowData.push(mapped);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (i >= (skipInitial + size)) {\n\t\t\t\t// Treat windowData as FIFO rolling buffer\n\t\t\t\twindowData.shift();\n\t\t\t}\n\t\t\twindowData.push(source(d, i));\n\t\t\tmapped = accumulator(windowData, i, accumulatorIdx++);\n\t\t\tresult.push(mapped);\n\t\t\twindowData.pop();\n\t\t\twindowData.push(mapped);\n\t\t\treturn;\n\t\t});\n\t\treturn result;\n\t};\n\n\tmappedSlidingWindow.undefinedValue = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn undefinedValue;\n\t\t}\n\t\tundefinedValue = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.windowSize = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn windowSize;\n\t\t}\n\t\twindowSize = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.accumulator = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn accumulator;\n\t\t}\n\t\taccumulator = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.skipInitial = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn skipInitial;\n\t\t}\n\t\tskipInitial = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\tmappedSlidingWindow.source = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn source;\n\t\t}\n\t\tsource = x;\n\t\treturn mappedSlidingWindow;\n\t};\n\n\treturn mappedSlidingWindow;\n}"]}