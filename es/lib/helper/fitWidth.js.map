{"version":3,"sources":["../../../../src/lib/helper/fitWidth.js"],"names":["React","Component","isDefined","getDisplayName","Series","name","displayName","fitWidth","WrappedComponent","withRef","minWidth","ResponsiveComponent","props","handleWindowResize","bind","getWrappedInstance","saveNode","setTestCanvas","state","node","testCanvas","context","getContext","devicePixelRatio","window","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","ratio","addEventListener","setState","getRatio","removeEventListener","width","el","getComputedStyle","parentNode","paddingLeft","paddingRight","w","parseFloat","Math","max","ref"],"mappings":"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","file":"fitWidth.js","sourcesContent":["import React, { Component } from \"react\";\n// import ReactDOM from \"react-dom\";\n\nimport { isDefined } from \"../utils\";\n\nfunction getDisplayName(Series) {\n\tconst name = Series.displayName || Series.name || \"Series\";\n\treturn name;\n}\n\nexport default function fitWidth(WrappedComponent, withRef = true, minWidth = 100) {\n\tclass ResponsiveComponent extends Component {\n\t\tconstructor(props) {\n\t\t\tsuper(props);\n\t\t\tthis.handleWindowResize = this.handleWindowResize.bind(this);\n\t\t\tthis.getWrappedInstance = this.getWrappedInstance.bind(this);\n\t\t\tthis.saveNode = this.saveNode.bind(this);\n\t\t\tthis.setTestCanvas = this.setTestCanvas.bind(this);\n\t\t\tthis.state = {};\n\t\t}\n\t\tsaveNode(node) {\n\t\t\tthis.node = node;\n\t\t}\n\t\tsetTestCanvas(node) {\n\t\t\tthis.testCanvas = node;\n\t\t}\n\t\tgetRatio() {\n\t\t\tif (isDefined(this.testCanvas)) {\n\t\t\t\tconst context = this.testCanvas.getContext(\"2d\");\n\n\t\t\t\tconst devicePixelRatio = window.devicePixelRatio || 1;\n\t\t\t\tconst backingStoreRatio = context.webkitBackingStorePixelRatio ||\n\t\t\t\t\tcontext.mozBackingStorePixelRatio ||\n\t\t\t\t\tcontext.msBackingStorePixelRatio ||\n\t\t\t\t\tcontext.oBackingStorePixelRatio ||\n\t\t\t\t\tcontext.backingStorePixelRatio || 1;\n\n\t\t\t\tconst ratio = devicePixelRatio / backingStoreRatio;\n\t\t\t\t// console.log(\"ratio = \", ratio);\n\t\t\t\treturn ratio;\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\tcomponentDidMount() {\n\t\t\twindow.addEventListener(\"resize\", this.handleWindowResize);\n\t\t\tthis.handleWindowResize();\n\t\t\t/* eslint-disable react/no-did-mount-set-state */\n\t\t\tthis.setState({\n\t\t\t\tratio: this.getRatio(),\n\t\t\t});\n\t\t\t/* eslint-enable react/no-did-mount-set-state */\n\t\t}\n\t\tcomponentWillUnmount() {\n\t\t\twindow.removeEventListener(\"resize\", this.handleWindowResize);\n\t\t}\n\t\thandleWindowResize() {\n\t\t\tthis.setState({\n\t\t\t\twidth: 0\n\t\t\t}, () => {\n\t\t\t\tconst el = this.node;\n\t\t\t\tconst { width, paddingLeft, paddingRight } = window.getComputedStyle(el.parentNode);\n\n\t\t\t\tconst w = parseFloat(width) - (parseFloat(paddingLeft) + parseFloat(paddingRight));\n\n\t\t\t\tthis.setState({\n\t\t\t\t\twidth: Math.max(w, minWidth)\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tgetWrappedInstance() {\n\t\t\treturn this.node;\n\t\t}\n\t\trender() {\n\t\t\tconst ref = withRef ? { ref: this.saveNode } : {};\n\n\t\t\tif (this.state.width) {\n\t\t\t\treturn <WrappedComponent width={this.state.width} ratio={this.state.ratio} {...this.props} {...ref} />;\n\t\t\t} else {\n\t\t\t\treturn <div {...ref}>\n\t\t\t\t\t<canvas ref={this.setTestCanvas}  />\n\t\t\t\t</div>;\n\t\t\t}\n\t\t}\n\t}\n\n\tResponsiveComponent.displayName = `fitWidth(${ getDisplayName(WrappedComponent) })`;\n\n\treturn ResponsiveComponent;\n}\n\n"]}