{"version":3,"sources":["../../../src/lib/calculator/atr.js"],"names":["options","source","open","d","high","low","close","calculator","data","windowSize","trueRangeAlgorithm","undefinedValue","accumulator","prev","values","Math","max","prevATR","atrAlgorithm","skipInitial","tr","atr","newData","undefinedLength","x","arguments","length"],"mappings":"AAAA;;;;;;;;kBAOe,YAAW;;AAEzB,KAAIA,2CAAJ;AACA,KAAIC,SAAS;AAAA,SAAM,EAAEC,MAAMC,EAAED,IAAV,EAAgBE,MAAMD,EAAEC,IAAxB,EAA8BC,KAAKF,EAAEE,GAArC,EAA0CC,OAAOH,EAAEG,KAAnD,EAAN;AAAA,EAAb;;AAEA,UAASC,UAAT,CAAoBC,IAApB,EAA0B;AAAA,iBACFR,OADE;AAAA,MACjBS,UADiB,YACjBA,UADiB;;;AAGzB,MAAMC,qBAAqB,4BACzBD,UADyB,CACd,CADc,EAEzBR,MAFyB,CAElBA,MAFkB,EAGzBU,cAHyB,CAGV;AAAA,UAAKR,EAAEC,IAAF,GAASD,EAAEE,GAAhB;AAAA,GAHU,EAGW;AAHX,GAIzBO,WAJyB,CAIb,kBAAU;AACtB,OAAMC,OAAOC,OAAO,CAAP,CAAb;AACA,OAAMX,IAAIW,OAAO,CAAP,CAAV;AACA,UAAOC,KAAKC,GAAL,CAASb,EAAEC,IAAF,GAASD,EAAEE,GAApB,EACNF,EAAEC,IAAF,GAASS,KAAKP,KADR,EAENH,EAAEE,GAAF,GAAQQ,KAAKP,KAFP,CAAP;AAGA,GAVyB,CAA3B;;AAYA,MAAIW,gBAAJ;;AAEA,MAAMC,eAAe,4BACnBC,WADmB,CACP,CADO,EACJ;AADI,GAEnBV,UAFmB,CAERA,UAFQ,EAGnBG,WAHmB,CAGP,kBAAU;AACtB,OAAMQ,KAAK,iBAAKN,MAAL,CAAX;AACA,OAAMO,MAAM,sBAAUJ,OAAV,IACT,CAAEA,WAAWR,aAAa,CAAxB,CAAD,GAA+BW,EAAhC,IAAsCX,UAD7B,GAET,kBAAIK,MAAJ,IAAcL,UAFjB;;AAIAQ,aAAUI,GAAV;AACA,UAAOA,GAAP;AACA,GAXmB,CAArB;;AAaA,MAAMC,UAAUJ,aAAaR,mBAAmBF,IAAnB,CAAb,CAAhB;;AAEA,SAAOc,OAAP;AACA;AACDf,YAAWgB,eAAX,GAA6B,YAAW;AAAA,kBAChBvB,OADgB;AAAA,MAC/BS,UAD+B,aAC/BA,UAD+B;;AAEvC,SAAOA,aAAa,CAApB;AACA,EAHD;AAIAF,YAAWP,OAAX,GAAqB,UAASwB,CAAT,EAAY;AAChC,MAAI,CAACC,UAAUC,MAAf,EAAuB;AACtB,UAAO1B,OAAP;AACA;AACDA,4DAAkCwB,CAAlC;AACA,SAAOjB,UAAP;AACA,EAND;;AAQAA,YAAWN,MAAX,GAAoB,UAASuB,CAAT,EAAY;AAC/B,MAAI,CAACC,UAAUC,MAAf,EAAuB;AACtB,UAAOzB,MAAP;AACA;AACDA,WAASuB,CAAT;AACA,SAAOjB,UAAP;AACA,EAND;;AAQA,QAAOA,UAAP;AACA,C;;AAjED;;AAEA;;AACA","file":"atr.js","sourcesContent":["\"use strict\";\n\nimport { sum } from \"d3-array\";\n\nimport { ATR as defaultOptions } from \"./defaultOptionsForComputation\";\nimport { slidingWindow, last, isDefined } from \"../utils\";\n\nexport default function() {\n\n\tlet options = defaultOptions;\n\tlet source = d => ({ open: d.open, high: d.high, low: d.low, close: d.close });\n\n\tfunction calculator(data) {\n\t\tconst { windowSize } = options;\n\n\t\tconst trueRangeAlgorithm = slidingWindow()\n\t\t\t.windowSize(2)\n\t\t\t.source(source)\n\t\t\t.undefinedValue(d => d.high - d.low) // the first TR value is simply the High minus the Low\n\t\t\t.accumulator(values => {\n\t\t\t\tconst prev = values[0];\n\t\t\t\tconst d = values[1];\n\t\t\t\treturn Math.max(d.high - d.low,\n\t\t\t\t\td.high - prev.close,\n\t\t\t\t\td.low - prev.close);\n\t\t\t});\n\n\t\tlet prevATR;\n\n\t\tconst atrAlgorithm = slidingWindow()\n\t\t\t.skipInitial(1) // trueRange starts from index 1 so ATR starts from 1\n\t\t\t.windowSize(windowSize)\n\t\t\t.accumulator(values => {\n\t\t\t\tconst tr = last(values);\n\t\t\t\tconst atr = isDefined(prevATR)\n\t\t\t\t\t? ((prevATR * (windowSize - 1)) + tr) / windowSize\n\t\t\t\t\t: sum(values) / windowSize;\n\n\t\t\t\tprevATR = atr;\n\t\t\t\treturn atr;\n\t\t\t});\n\n\t\tconst newData = atrAlgorithm(trueRangeAlgorithm(data));\n\n\t\treturn newData;\n\t}\n\tcalculator.undefinedLength = function() {\n\t\tconst { windowSize } = options;\n\t\treturn windowSize - 1;\n\t};\n\tcalculator.options = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn options;\n\t\t}\n\t\toptions = { ...defaultOptions, ...x };\n\t\treturn calculator;\n\t};\n\n\tcalculator.source = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn source;\n\t\t}\n\t\tsource = x;\n\t\treturn calculator;\n\t};\n\n\treturn calculator;\n}\n"]}