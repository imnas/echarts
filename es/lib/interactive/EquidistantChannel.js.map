{"version":3,"sources":["../../../../src/lib/interactive/EquidistantChannel.js"],"names":["React","Component","PropTypes","isDefined","isNotDefined","noop","terminate","saveNodeType","isHoverForInteractiveType","EachEquidistantChannel","getSlope","getYIntercept","MouseLocationIndicator","HoverTextNearMouse","EquidistantChannel","props","handleStart","bind","handleEnd","handleDrawChannel","handleDragChannel","handleDragChannelComplete","getSelectionState","nodes","state","index","newXYValue","setState","override","moreProps","channels","rest","newChannels","map","each","idx","selected","onComplete","xyValue","current","startXY","mouseMoved","dy","endXY","m","b","y","onStart","e","appearance","d","enabled","currentPositionRadius","currentPositionStroke","currentPositionOpacity","currentPositionStrokeWidth","hoverText","overrideIndex","tempChannel","eachAppearance","propTypes","bool","isRequired","func","onSelect","string","number","object","array","shape","stroke","strokeOpacity","strokeWidth","fill","fillOpacity","edgeStroke","edgeFill","edgeFill2","edgeStrokeWidth","r","defaultProps","enable","bgHeight","bgWidth","text"],"mappings":"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","file":"EquidistantChannel.js","sourcesContent":["\"use strict\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport { isDefined, isNotDefined, noop } from \"../utils\";\nimport {\n\tterminate,\n\tsaveNodeType,\n\tisHoverForInteractiveType,\n} from \"./utils\";\nimport EachEquidistantChannel from \"./hoc/EachEquidistantChannel\";\nimport { getSlope, getYIntercept } from \"./components/StraightLine\";\nimport MouseLocationIndicator from \"./components/MouseLocationIndicator\";\nimport HoverTextNearMouse from \"./components/HoverTextNearMouse\";\n\nclass EquidistantChannel extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.handleStart = this.handleStart.bind(this);\n\t\tthis.handleEnd = this.handleEnd.bind(this);\n\t\tthis.handleDrawChannel = this.handleDrawChannel.bind(this);\n\t\tthis.handleDragChannel = this.handleDragChannel.bind(this);\n\t\tthis.handleDragChannelComplete = this.handleDragChannelComplete.bind(this);\n\n\t\tthis.terminate = terminate.bind(this);\n\t\tthis.saveNodeType = saveNodeType.bind(this);\n\n\t\tthis.getSelectionState = isHoverForInteractiveType(\"channels\")\n\t\t\t.bind(this);\n\n\t\tthis.nodes = [];\n\t\tthis.state = {\n\t\t};\n\t}\n\thandleDragChannel(index, newXYValue) {\n\t\tthis.setState({\n\t\t\toverride: {\n\t\t\t\tindex,\n\t\t\t\t...newXYValue\n\t\t\t}\n\t\t});\n\t}\n\thandleDragChannelComplete(moreProps) {\n\t\tconst { override } = this.state;\n\t\tconst { channels } = this.props;\n\n\t\tif (isDefined(override)) {\n\t\t\tconst { index, ...rest } = override;\n\t\t\tconst newChannels = channels\n\t\t\t\t.map((each, idx) => idx === index\n\t\t\t\t\t? { ...each, ...rest, selected: true }\n\t\t\t\t\t: each);\n\t\t\tthis.setState({\n\t\t\t\toverride: null,\n\t\t\t}, () => {\n\t\t\t\tthis.props.onComplete(newChannels, moreProps);\n\t\t\t});\n\t\t}\n\t}\n\thandleDrawChannel(xyValue) {\n\t\tconst { current } = this.state;\n\n\t\tif (isDefined(current)\n\t\t\t\t&& isDefined(current.startXY)) {\n\t\t\tthis.mouseMoved = true;\n\t\t\tif (isNotDefined(current.dy)) {\n\t\t\t\tthis.setState({\n\t\t\t\t\tcurrent: {\n\t\t\t\t\t\tstartXY: current.startXY,\n\t\t\t\t\t\tendXY: xyValue,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst m = getSlope(current.startXY, current.endXY);\n\t\t\t\tconst b = getYIntercept(m, current.endXY);\n\t\t\t\tconst y = m * xyValue[0] + b;\n\t\t\t\tconst dy = xyValue[1] - y;\n\n\t\t\t\tthis.setState({\n\t\t\t\t\tcurrent: {\n\t\t\t\t\t\t...current,\n\t\t\t\t\t\tdy,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\thandleStart(xyValue) {\n\t\tconst { current } = this.state;\n\n\t\tif (isNotDefined(current) || isNotDefined(current.startXY)) {\n\t\t\tthis.mouseMoved = false;\n\t\t\tthis.setState({\n\t\t\t\tcurrent: {\n\t\t\t\t\tstartXY: xyValue,\n\t\t\t\t\tendXY: null,\n\t\t\t\t}\n\t\t\t}, () => {\n\t\t\t\tthis.props.onStart();\n\t\t\t});\n\t\t}\n\t}\n\thandleEnd(xyValue, moreProps, e) {\n\t\tconst { current } = this.state;\n\t\tconst { channels, appearance } = this.props;\n\n\t\tif (this.mouseMoved\n\t\t\t&& isDefined(current)\n\t\t\t&& isDefined(current.startXY)\n\t\t) {\n\n\t\t\tif (isNotDefined(current.dy)) {\n\t\t\t\tthis.setState({\n\t\t\t\t\tcurrent: {\n\t\t\t\t\t\t...current,\n\t\t\t\t\t\tdy: 0\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst newChannels = [\n\t\t\t\t\t...channels.map(d => ({ ...d, selected: false })),\n\t\t\t\t\t{\n\t\t\t\t\t\t...current, selected: true,\n\t\t\t\t\t\tappearance,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tthis.setState({\n\t\t\t\t\tcurrent: null,\n\t\t\t\t}, () => {\n\n\t\t\t\t\tthis.props.onComplete(newChannels, moreProps, e);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\trender() {\n\t\tconst { appearance } = this.props;\n\t\tconst { enabled } = this.props;\n\t\tconst { currentPositionRadius, currentPositionStroke } = this.props;\n\t\tconst { currentPositionOpacity, currentPositionStrokeWidth } = this.props;\n\t\tconst { channels, hoverText } = this.props;\n\t\tconst { current, override } = this.state;\n\t\tconst overrideIndex = isDefined(override) ? override.index : null;\n\n\t\tconst tempChannel = isDefined(current) && isDefined(current.endXY)\n\t\t\t? <EachEquidistantChannel\n\t\t\t\tinteractive={false}\n\t\t\t\t{...current}\n\t\t\t\tappearance={appearance}\n\t\t\t\thoverText={hoverText} />\n\t\t\t: null;\n\n\t\treturn <g>\n\t\t\t{channels.map((each, idx) => {\n\t\t\t\tconst eachAppearance = isDefined(each.appearance)\n\t\t\t\t\t? { ...appearance, ...each.appearance }\n\t\t\t\t\t: appearance;\n\n\t\t\t\treturn <EachEquidistantChannel key={idx}\n\t\t\t\t\tref={this.saveNodeType(idx)}\n\t\t\t\t\tindex={idx}\n\t\t\t\t\tselected={each.selected}\n\t\t\t\t\thoverText={hoverText}\n\t\t\t\t\t{...(idx === overrideIndex ? override : each)}\n\t\t\t\t\tappearance={eachAppearance}\n\t\t\t\t\tonDrag={this.handleDragChannel}\n\t\t\t\t\tonDragComplete={this.handleDragChannelComplete}\n\t\t\t\t/>;\n\t\t\t})}\n\t\t\t{tempChannel}\n\t\t\t<MouseLocationIndicator\n\t\t\t\tenabled={enabled}\n\t\t\t\tsnap={false}\n\t\t\t\tr={currentPositionRadius}\n\t\t\t\tstroke={currentPositionStroke}\n\t\t\t\topacity={currentPositionOpacity}\n\t\t\t\tstrokeWidth={currentPositionStrokeWidth}\n\t\t\t\tonMouseDown={this.handleStart}\n\t\t\t\tonClick={this.handleEnd}\n\t\t\t\tonMouseMove={this.handleDrawChannel} />\n\t\t</g>;\n\t}\n}\n\n\nEquidistantChannel.propTypes = {\n\tenabled: PropTypes.bool.isRequired,\n\n\tonStart: PropTypes.func.isRequired,\n\tonComplete: PropTypes.func.isRequired,\n\tonSelect: PropTypes.func.isRequired,\n\n\tcurrentPositionStroke: PropTypes.string,\n\tcurrentPositionStrokeWidth: PropTypes.number,\n\tcurrentPositionOpacity: PropTypes.number,\n\tcurrentPositionRadius: PropTypes.number,\n\n\thoverText: PropTypes.object.isRequired,\n\tchannels: PropTypes.array.isRequired,\n\n\tappearance: PropTypes.shape({\n\t\tstroke: PropTypes.string.isRequired,\n\t\tstrokeOpacity: PropTypes.number.isRequired,\n\t\tstrokeWidth: PropTypes.number.isRequired,\n\t\tfill: PropTypes.string.isRequired,\n\t\tfillOpacity: PropTypes.number.isRequired,\n\t\tedgeStroke: PropTypes.string.isRequired,\n\t\tedgeFill: PropTypes.string.isRequired,\n\t\tedgeFill2: PropTypes.string.isRequired,\n\t\tedgeStrokeWidth: PropTypes.number.isRequired,\n\t\tr: PropTypes.number.isRequired,\n\t}).isRequired\n};\n\nEquidistantChannel.defaultProps = {\n\tonStart: noop,\n\tonComplete: noop,\n\tonSelect: noop,\n\n\tcurrentPositionStroke: \"#000000\",\n\tcurrentPositionOpacity: 1,\n\tcurrentPositionStrokeWidth: 3,\n\tcurrentPositionRadius: 4,\n\n\thoverText: {\n\t\t...HoverTextNearMouse.defaultProps,\n\t\tenable: true,\n\t\tbgHeight: 18,\n\t\tbgWidth: 120,\n\t\ttext: \"Click to select object\",\n\t},\n\tchannels: [],\n\tappearance: {\n\t\tstroke: \"#000000\",\n\t\tstrokeOpacity: 1,\n\t\tstrokeWidth: 1,\n\t\tfill: \"#8AAFE2\",\n\t\tfillOpacity: 0.7,\n\t\tedgeStroke: \"#000000\",\n\t\tedgeFill: \"#FFFFFF\",\n\t\tedgeFill2: \"#250B98\",\n\t\tedgeStrokeWidth: 1,\n\t\tr: 5,\n\t}\n};\n\nexport default EquidistantChannel;\n"]}