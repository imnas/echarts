{"version":3,"sources":["../../../../src/lib/calculator/sar.js"],"names":["mappedSlidingWindow","isNotDefined","isDefined","SAR","defaultOptions","calc","prev","now","risingSar","af","risingEp","fallingSar","fallingEp","Math","max","high","min","low","options","calculator","data","accelerationFactor","maxAccelerationFactor","algorithm","windowSize","undefinedValue","accumulator","use","current","date","sar","calculatedData","map","d","undefinedLength","x","arguments","length"],"mappings":"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","file":"sar.js","sourcesContent":["\"use strict\";\n\nimport { mappedSlidingWindow, isNotDefined, isDefined } from \"../utils\";\nimport { SAR as defaultOptions } from \"./defaultOptionsForComputation\";\n\nfunction calc(prev, now) {\n\tconst risingSar = prev.risingSar\n\t\t+ prev.af * (prev.risingEp - prev.risingSar);\n\n\tconst fallingSar = prev.fallingSar\n\t\t- prev.af * (prev.fallingSar - prev.fallingEp);\n\n\tconst risingEp = Math.max(prev.risingEp, now.high);\n\tconst fallingEp = Math.min(prev.fallingEp, now.low);\n\n\treturn {\n\t\trisingSar,\n\t\tfallingSar,\n\t\trisingEp,\n\t\tfallingEp,\n\t};\n}\n\nexport default function() {\n\n\tlet options = defaultOptions;\n\n\tfunction calculator(data) {\n\t\tconst { accelerationFactor, maxAccelerationFactor } = options;\n\n\t\tconst algorithm = mappedSlidingWindow()\n\t\t\t.windowSize(2)\n\t\t\t.undefinedValue(({ high, low }) => {\n\t\t\t\treturn {\n\t\t\t\t\trisingSar: low,\n\t\t\t\t\trisingEp: high,\n\t\t\t\t\tfallingSar: high,\n\t\t\t\t\tfallingEp: low,\n\t\t\t\t\taf: accelerationFactor,\n\t\t\t\t};\n\t\t\t})\n\t\t\t.accumulator(([prev, now]) => {\n\n\t\t\t\tconst {\n\t\t\t\t\trisingSar,\n\t\t\t\t\tfallingSar,\n\t\t\t\t\trisingEp,\n\t\t\t\t\tfallingEp,\n\t\t\t\t} = calc(prev, now);\n\n\t\t\t\tif (isNotDefined(prev.use)\n\t\t\t\t\t\t&& risingSar > now.low\n\t\t\t\t\t\t&& fallingSar < now.high) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\trisingSar,\n\t\t\t\t\t\tfallingSar,\n\t\t\t\t\t\trisingEp,\n\t\t\t\t\t\tfallingEp,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tconst use = isDefined(prev.use)\n\t\t\t\t\t? prev.use === \"rising\"\n\t\t\t\t\t\t? risingSar > now.low ? \"falling\" : \"rising\"\n\t\t\t\t\t\t: fallingSar < now.high ? \"rising\" : \"falling\"\n\t\t\t\t\t: risingSar > now.low\n\t\t\t\t\t\t? \"falling\"\n\t\t\t\t\t\t: \"rising\";\n\n\t\t\t\tconst current = prev.use === use\n\t\t\t\t\t? {\n\t\t\t\t\t\taf: Math.min(maxAccelerationFactor, prev.af + accelerationFactor),\n\t\t\t\t\t\tfallingEp,\n\t\t\t\t\t\trisingEp,\n\t\t\t\t\t\tfallingSar,\n\t\t\t\t\t\trisingSar,\n\t\t\t\t\t}\n\t\t\t\t\t: {\n\t\t\t\t\t\taf: accelerationFactor,\n\t\t\t\t\t\tfallingEp: now.low,\n\t\t\t\t\t\trisingEp: now.high,\n\t\t\t\t\t\tfallingSar: Math.max(prev.risingEp, now.high),\n\t\t\t\t\t\trisingSar: Math.min(prev.fallingEp, now.low),\n\t\t\t\t\t};\n\n\t\t\t\tconst { date, high, low } = now;\n\t\t\t\treturn {\n\t\t\t\t\tdate,\n\t\t\t\t\thigh,\n\t\t\t\t\tlow,\n\t\t\t\t\t...current,\n\t\t\t\t\tuse,\n\t\t\t\t\tsar: use === \"falling\" ? current.fallingSar : current.risingSar,\n\t\t\t\t};\n\t\t\t});\n\n\t\tconst calculatedData = algorithm(data).map(d => d.sar);\n\t\t// console.log(calculatedData);\n\n\t\treturn calculatedData;\n\t}\n\tcalculator.undefinedLength = function() {\n\t\treturn 1;\n\t};\n\tcalculator.options = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn options;\n\t\t}\n\t\toptions = { ...defaultOptions, ...x };\n\t\treturn calculator;\n\t};\n\n\treturn calculator;\n}\n"]}